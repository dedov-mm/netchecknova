<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NetCheckNova UI</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      text-align: center;
      background: white;
      padding: 2em;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
    }
    .spinner {
      display: none;
      margin: 1em 0;
    }
    .result {
      margin-top: 1em;
      font-weight: bold;
    }
    .available {
      color: green;
    }
    .not-available {
      color: red;
    }
    input[type="text"] {
      width: 80%;
      padding: 0.5em;
      font-size: 1em;
    }
    button {
      padding: 0.5em 1em;
      font-size: 1em;
      margin-top: 1em;
    }

    .spinner {
      display: none;
      margin: 1em auto;
      border: 4px solid #f3f3f3; /* —Å–≤–µ—Ç–ª–∞—è —á–∞—Å—Ç—å */
      border-top: 4px solid #3498db; /* —Å–∏–Ω—è—è —á–∞—Å—Ç—å */
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>NetCheckNova</h1>
    <form id="check-form">
      <input type="text" id="address" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 8.8.8.8:53 –∏–ª–∏ https://site:443" required />
      <br>
      <button type="submit" id="check-button">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </form>
    <div class="spinner" id="spinner"></div>
    <div id="result" class="result"></div>
  </div>

  <script>
    const form = document.getElementById('check-form');
    const spinner = document.getElementById('spinner');
    const resultDiv = document.getElementById('result');
    const button = document.getElementById('check-button');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const addressInput = document.getElementById('address').value.trim();
      if (!addressInput) return;

      let host = '';
      let port = '';

      // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å —á–µ—Ä–µ–∑ URL, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ —Å—Ö–µ–º–∞
      try {
        let url;
        if (/^https?:\/\//i.test(addressInput)) {
          url = new URL(addressInput);
        } else {
          // –ï—Å–ª–∏ —Å—Ö–µ–º—ã –Ω–µ—Ç, –ø–æ–¥—Å—Ç–∞–≤–∏–º http:// –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
          url = new URL(`http://${addressInput}`);
        }
        host = url.hostname;
        port = url.port;
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = '<span class="not-available">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å</span>';
        return;
      }

      if (!port) {
        resultDiv.innerHTML = '<span class="not-available">–£–∫–∞–∂–∏—Ç–µ –ø–æ—Ä—Ç –≤ –∞–¥—Ä–µ—Å–µ</span>';
        return;
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä –∏ –≤—ã–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫—É
      spinner.style.display = 'block';
      button.disabled = true;
      resultDiv.textContent = '';

      try {
        const response = await axios.get('/check', {
          params: { host, port }
        });
        const data = response.data;

        let msg = '';
        if (data.ping_success && data.port_success) {
          msg = '<span class="available">‚úÖ Available</span>';
        } else {
          msg = '<span class="not-available">‚ùå Not available</span><br>';
          if (!data.ping_success) {
            msg += `üîπ Ping failed (${data.ping_summary})<br>`;
          }
          if (!data.port_success) {
            msg += `üîπ Port failed (${data.port_error})`;
          }
        }

        resultDiv.innerHTML = msg;
      } catch (error) {
        console.error(error);
        resultDiv.innerHTML = '<span class="not-available">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ</span>';
      } finally {
        spinner.style.display = 'none';
        button.disabled = false;
      }
    });
  </script>
</body>
</html>
